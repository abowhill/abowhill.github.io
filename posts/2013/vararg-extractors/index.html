<!doctype html>
<!--[if lte IE 7]>
  <meta http-equiv="refresh" content="0" url="http://browsehappy.com/" />
  <script type="text/javascript">
  /* <![CDATA[ */
  window.top.location = 'http://browsehappy.com/';
  /* ]]> */
  </script>
<![endif]-->
<!--[if IE 8]><html class="ie8"> <![endif]-->
<!--[if gt IE 8]><!--><html class="gt-ie8"><!--<![endif]-->
  
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="cleartype" content="on">
    <meta name="author" content="">
    <meta name="description" content="Syntaxfx">

    <title>Extractors in Scala | Syntax FX</title>
    <link href="../../../stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
<script src="../../../javascripts/core.js" type="text/javascript"></script>
    <script type="text/javascript">
      WebFontConfig = {
         google: { families: [ 'IM+Fell+DW+Pica+SC::latin', 'Averia+Gruesa+Libre::latin', 'Asap::latin', 'Noto+Sans::latin' ] }
      };
      (function() {
        var wf = document.createElement('script');
        wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
          '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
        wf.type = 'text/javascript';
        wf.async = 'true';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wf, s);
      })(); 
    </script>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="../../../images/favicon.png" rel="icon" type="image/png" />
    <link href="../../../images/favicon.ico" rel="icon" type="image/ico" />
<!-- MathJax Library -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG"> </script>
  </head>
  
  <body lang="en">
    <div id="container">
      <header>
        <h1>
<svg xmlns:xlink="http://www.w3.org/1999/xlink 
  width="850" height="200" viewBox="0 0 850 200" 
  preserveAspectRatio="slice">

  <a xlink:href="/" xlink:show="replace">
  <style type="text/css">
     rect:hover {fill:green}
     circle:hover {fill:green}
     text:hover {fill:green}
  </style>
     <rect width="850" height="200" 
        fill="#D6302B" fill-opacity="1.0" 
        stroke="black" stroke-width="1" />
     <circle cx="550" cy="100" r="140" 
        fill="#E85832" fill-opacity="1.0" 
        stroke="black" stroke-width="10" />
     <circle cx="550" cy="100" r="100" 
        fill="#FF7A26" fill-opacity="1.0" 
        stroke="black" stroke-width="3" />
     <circle cx="550" cy="100" r="60" 
        fill="#E8AE63" fill-opacity="1.0" 
        stroke="black" stroke-width="5" />
     <circle cx="550" cy="100" r="30" 
        fill="green" fill-opacity="1.0" 
        stroke="black" stroke-width="10" />
     <text x="0" y="195" font-size="180" text-anchor="left" 
        fill="#FFC33B" stroke="black" 
        stroke-width="3">Syntax FX</text>
  </a>
</svg>
</h1>
  <div id="intro">
     <p class="subTitle details">Tech Blog by Allan Bowhill.</p>
  </div>

        <nav class="clearfix">
          <div class="navButton button previousButton">
            <a class="previous details" href="/posts/2013/empty-shell-project/"><i class="icon-backward left-more"></i>Earlier</a>
          </div>
          
          
            <div class="navButton button nextButton">
              <a href="/posts/2013/console-testing-with-execution-harness/" class="next details">Later<i class="icon-forward right-more"></i></a>
            </div>
          
         <span class="navLinks details"><a href="http://twitter.com"><i class="icon-twitter"></i>Twitter</a><a href="/rss.rss"><i class="icon-rss"></i>RSS</a><a class="last" href="mailto:blank@blank.com"><i class="icon-envelope-alt"></i>Contact</a></span>
        </nav>
      </header>
      <article class="single">
        <h2><a href="/posts/2013/vararg-extractors/">Extractors in Scala</a></h2>
        <span class="postDetails clearfix"><time class="date details">Dec  3 2013</time><span class="tagLinks details">Tags: 	
	  <span class="tags"><a class="tags" href="/posts/tags/scala/">scala</a></span>
	
	  <span class="tags"><a class="tags" href="/posts/tags/programming/">programming</a></span>
	</span></span>
        <p>Extraction and reporting are intertwined. Data is presented to you in some kind of structured source, and you must pull it into meaningful program variables to be able to manipulate it and return a result. Some of the best language designs make this easy. <strong>Perl</strong> (Practical Extraction and Reporting Language) recognized this use case, and built a neat little feature into the language that transforms serialized data into variables in a single line of code.</p>

<p>The form looks similar to this:</p>

<p><code>
($var1, $var2, $var3) = some_sequential_data_source
</code></p>

<p>So, if I create an array reference in Perl:</p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div></td><td class="code">$a = [1,2,3]
</td></tr></tbody></table></pre><p />

<p>I can extract data from that array into meaningful variables with one line of code:</p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div></td><td class="code">($one, $two, $three) = @$a;
</td></tr></tbody></table></pre><p />

<p>This has big payoff when reading all the metadata in a UNIX filename:</p>

<pre class="highlight perl"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div></td><td class="code"><span class="c1"># from man perlfunc and [perldoc](http://perldoc.perl.org/functions/stat.html)</span>

<span class="p">(</span><span class="nv">$dev</span><span class="p">,</span><span class="nv">$ino</span><span class="p">,</span><span class="nv">$mode</span><span class="p">,</span><span class="nv">$nlink</span><span class="p">,</span><span class="nv">$uid</span><span class="p">,</span><span class="nv">$gid</span><span class="p">,</span><span class="nv">$rdev</span><span class="p">,</span><span class="nv">$size</span><span class="p">,</span><span class="nv">$atime</span><span class="p">,</span><span class="nv">$mtime</span><span class="p">,</span><span class="nv">$ctime</span><span class="p">,</span><span class="nv">$blksize</span><span class="p">,</span><span class="nv">$blocks</span><span class="p">)</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</td></tr></tbody></table></pre><p />

<p>It is definitely a convenience. Try doing that in C++ in a single line!</p>

<p>In <strong>Scala</strong>, there is a mechanism that can be constructed that appears to resemble this Perl-ism. It’s called an extractor. Although there is a lot more code than one line to make it, plus a lot of implicit behavior under the hood, you can still employ a</p>

<p><code>
sink = source
</code></p>

<p>kind of pattern in your own code. With extractors you can transform a data source (even with variable arguments) into a set of coherent, meaningful variables in one line. Yes, you can kind of imitate <strong>Perl</strong> in <strong>Scala</strong>!</p>

<p>Just like the left hand side of the Perl-ism, out of the box you can write something like:</p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div></td><td class="code">scala&gt; val Array(one, two, three) = Array(1,2,3)
one: Int = 1
two: Int = 2
three: Int = 3
</td></tr></tbody></table></pre><p />

<p>As you may have noticed, the left hand side names some variables to recieve data, and the right hand side supplies them. Source to Sink. Furthermore, you can create your own objects, with their very own transformation rules. This is done through the <strong>unapply()</strong> method, which can be added to an object. It is called implicitly like a constructor, when you use it on the left hand side of an assignment.</p>

<p><strong>Unapply()</strong> is kind of the opposite of a mock constuctor for an object. Since objects are singleton entities that have no actual type, they have no constructor. But a mock constructor of a kind can be created by adding an <strong>apply()</strong> method. </p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div></td><td class="code">object SillyPerson {
   def apply (name: List[String]) = name.mkString(&quot; &quot;);
   }
</td></tr></tbody></table></pre><p />

<p>The <strong>apply()</strong> construct can only be used in a right-hand-side capacity (aka: as a Source, or supplier of data):</p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div></td><td class="code">scala&gt; val s = SillyPerson(&quot;Elmer&quot;::&quot;J.&quot;::&quot;Fudpucker&quot;::Nil)
s: String = Elmer J. Fudpucker
</td></tr></tbody></table></pre><p />

<p><strong>Unapply()</strong> is like a <em>deconstructor</em>. It can be designed to undo everything that an <strong>apply()</strong> method does. If we add one, we can now “deconstruct” a structured data source – even the apply method itself, which is a good test.</p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div><div class="lineno">5</div><div class="lineno">6</div><div class="lineno">7</div><div class="lineno">8</div><div class="lineno">9</div><div class="lineno">10</div><div class="lineno">11</div></td><td class="code">// based on examples from &quot;Programming in Scala&quot;, Odersky, Spoon &amp; Venners

object SillyPerson {
   def apply (name: List[String]) = name.mkString(&quot; &quot;)
   def unapply (name: String): Option[(String, String, String)] = 
       { 
        val bits = name.split(&quot; &quot;)
        if (bits.length == 3) Some(bits(0), bits(1), bits(2))
        else None
        }
    }
</td></tr></tbody></table></pre><p />

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div></td><td class="code">scala&gt; val SillyPerson(first, middle, last) = SillyPerson(&quot;Elmer&quot;::&quot;J.&quot;::&quot;Fudpucker&quot;::Nil)
first: String = Elmer
middle: String = J.
last: String = Fudpucker
</td></tr></tbody></table></pre><p />

<p>Above, the left hand side of = represents an implicit call to the <strong>unapply()</strong> method: the object’s acting pseudo-deconstructor and data sink. The right-hand-side represents a call to the objects pseudo-constructor and data source. Assigning the source to the sink should result in the same data we supplied to the source. The two methods should symmetrically compose and decompose the data to be considered correctly-implemented.</p>

<p>Note the <strong>unapply()</strong> method provides a return type of </p>

<p><code>
Option[(String, String, String)]
</code></p>

<p>Which gives structure and type-casting to the receiving variables: <strong>first</strong>, <strong>middle</strong> and <strong>last</strong>. The <strong>Some</strong> and <strong>None</strong> classes are wrappers around the data which tell the calling method there is either something or nothing returned, which is better than sending Null.</p>

<p>Below is an example of a <strong>varargs extractor</strong>, an <strong>unapply()</strong> that allows variable length lists to be processed and transformed. Seauences are used instead of a fixed <strong>Option</strong> type, allowing for more flexibility in handling paramters. In this case, a special variant of <em>unapply</em> is used, called <strong>unapplySeq()</strong>. This variant allows for sequences to be used in the Options return type, which can be iterated over by the caller. There is other special syntax when the unapplySeq() is actually called. </p>

<p>The basic description of this program is that a royal court (TheCourt) has been assembled. The Lord, Lady, an advisor, a general and some servants are all on a list of approved court-attenders. The list is ordered in a most-important to least-important ranking. The list starts off with a sloppy form, so it is first cleaned-up. Then someone in the court gets hold of it, and runs <strong>apply()</strong>. The <strong>apply()</strong> method messes up the list, reversing it and adding in an enemy spy. Last, the <strong>unapplySeq()</strong> method is run, and sets it all back correctly, removing the spy from the list and placing the ranks it back in the right order. </p>

<pre class="highlight text"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div><div class="lineno">5</div><div class="lineno">6</div><div class="lineno">7</div><div class="lineno">8</div><div class="lineno">9</div><div class="lineno">10</div><div class="lineno">11</div><div class="lineno">12</div><div class="lineno">13</div><div class="lineno">14</div><div class="lineno">15</div><div class="lineno">16</div><div class="lineno">17</div><div class="lineno">18</div><div class="lineno">19</div><div class="lineno">20</div><div class="lineno">21</div><div class="lineno">22</div><div class="lineno">23</div><div class="lineno">24</div><div class="lineno">25</div><div class="lineno">26</div><div class="lineno">27</div><div class="lineno">28</div><div class="lineno">29</div><div class="lineno">30</div><div class="lineno">31</div><div class="lineno">32</div><div class="lineno">33</div><div class="lineno">34</div><div class="lineno">35</div><div class="lineno">36</div><div class="lineno">37</div><div class="lineno">38</div><div class="lineno">39</div><div class="lineno">40</div><div class="lineno">41</div><div class="lineno">42</div><div class="lineno">43</div><div class="lineno">44</div><div class="lineno">45</div><div class="lineno">46</div><div class="lineno">47</div><div class="lineno">48</div></td><td class="code">// based on sect 24.5 Programming in scala
// varags extractor example.

object TheCourt
   {
   // apply puts the list in the wrong order and there is an unwanted guest.

   def apply(cleanList: String): String =
      {
      (cleanList.split(&quot;,&quot;) :+ &quot;EnemySpy&quot;).reverse.mkString(&quot;,&quot;)
      }

   // unapply dissects the list and undoes the damage

   def unapplySeq(wronglyOrderedList: String): Option[(String, String, Seq[String])] =
      {
      val rightList = wronglyOrderedList.split(&quot;,&quot;).reverse
      if (rightList.length &gt; 1)
        Some(rightList(0), rightList(1), rightList.drop(2).dropRight(1))
      else
         None
       }
   }

val sloppyList = &quot;Olaf the Magnificent, Helga the Great,&quot; +
   &quot;Advisor Sollop,  General Cranston      ,       Jeeves,  Seppings  ,&quot; +
   &quot;Mrs. North,Grell,    and whatsisface&quot;;

val cleanList = sloppyList.split(&quot;,&quot;).map(_.trim).mkString(&quot;,&quot;)

// assign the manipulations of the apply method to the unapply method. It should &quot;undo&quot; when combined

val TheCourt(lord, lady, theRest @ _*) = TheCourt(cleanList)

println(&quot;Original List: (cleaned up a bit)&quot;)
println(&quot;--------------&quot;)
println(cleanList)
println
println(&quot;Modified List: (apply)&quot;)
println(&quot;----------------------&quot;)
println(TheCourt(cleanList))
println
println (&quot;Fixed and Restored List: (unapply)&quot;)
println (&quot;----------------------------------&quot;)
println (&quot;The Lord: [&quot; + lord + &quot;]&quot;)
println (&quot;The Lady: [&quot; + lady + &quot;]&quot;)
for (name &lt;- theRest)
   println (&quot;  The court: [&quot; + name + &quot;]&quot;)
</td></tr></tbody></table></pre>
      </article>
      <footer class="footer clearfix">
	<div class="contact">
		<p class="details">Contact me, if that's what you want.</p>
	</div>
	<div class="links">
		<ul class="clearfix">
			<li class="details"><a href="/posts/2013.html">Archive</a></li>
			<li class="details"><a href="/rss.rss">RSS</a></li>
			<li class="details"><a href="mailto:allanbowhill@yahoo.com">Contact</a></li>
		</ul>
	</div>
</footer>

    </div>
  </body>
</html>
