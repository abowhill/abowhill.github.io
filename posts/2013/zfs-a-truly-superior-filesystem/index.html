<!doctype html>
<!--[if lte IE 7]>
  <meta http-equiv="refresh" content="0" url="http://browsehappy.com/" />
  <script type="text/javascript">
  /* <![CDATA[ */
  window.top.location = 'http://browsehappy.com/';
  /* ]]> */
  </script>
<![endif]-->
<!--[if IE 8]><html class="ie8"> <![endif]-->
<!--[if gt IE 8]><!--><html class="gt-ie8"><!--<![endif]-->
  
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="cleartype" content="on">
    <meta name="author" content="">
    <meta name="description" content="Syntaxfx">

    <title>ZFS: A truly Superior Filesystem | Syntax FX</title>
    <link href="../../../stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
<script src="../../../javascripts/core.js" type="text/javascript"></script>
    <script type="text/javascript">
      WebFontConfig = {
         google: { families: [ 'IM+Fell+DW+Pica+SC::latin', 'Averia+Gruesa+Libre::latin', 'Asap::latin', 'Noto+Sans::latin' ] }
      };
      (function() {
        var wf = document.createElement('script');
        wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
          '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
        wf.type = 'text/javascript';
        wf.async = 'true';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wf, s);
      })(); 
    </script>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="../../../images/favicon.png" rel="icon" type="image/png" />
    <link href="../../../images/favicon.ico" rel="icon" type="image/ico" />
  </head>
  
  <body lang="en">
    <div id="container">
      <header>
        <h1>
<svg xmlns:xlink="http://www.w3.org/1999/xlink 
  width="850" height="200" viewBox="0 0 850 200" 
  preserveAspectRatio="slice">

  <a xlink:href="/" xlink:show="replace">
  <style type="text/css">
     rect:hover {fill:green}
     circle:hover {fill:green}
     text:hover {fill:green}
  </style>
     <rect width="850" height="200" 
        fill="#D6302B" fill-opacity="1.0" 
        stroke="black" stroke-width="1" />
     <circle cx="550" cy="100" r="140" 
        fill="#E85832" fill-opacity="1.0" 
        stroke="black" stroke-width="10" />
     <circle cx="550" cy="100" r="100" 
        fill="#FF7A26" fill-opacity="1.0" 
        stroke="black" stroke-width="3" />
     <circle cx="550" cy="100" r="60" 
        fill="#E8AE63" fill-opacity="1.0" 
        stroke="black" stroke-width="5" />
     <circle cx="550" cy="100" r="30" 
        fill="green" fill-opacity="1.0" 
        stroke="black" stroke-width="10" />
     <text x="0" y="195" font-size="180" text-anchor="left" 
        fill="#FFC33B" stroke="black" 
        stroke-width="3">Syntax FX</text>
  </a>
</svg>
</h1>
  <div id="intro">
     <p class="subTitle details">Tech Blog by Allan Bowhill.</p>
  </div>

        <nav class="clearfix">
          <div class="navButton button previousButton">
            <a class="previous details" href="/posts/2013/on-the-quagmire-of-shell-dotfile-execution/"><i class="icon-backward left-more"></i>Earlier</a>
          </div>
          
          
            <div class="navButton button nextButton">
              <a href="/posts/2013/dotfile-map-for-several-shells/" class="next details">Later<i class="icon-forward right-more"></i></a>
            </div>
          
         <span class="navLinks details"><a href="http://twitter.com"><i class="icon-twitter"></i>Twitter</a><a href="/rss.rss"><i class="icon-rss"></i>RSS</a><a class="last" href="mailto:blank@blank.com"><i class="icon-envelope-alt"></i>Contact</a></span>
        </nav>
      </header>
      <article class="single">
        <h2><a href="/posts/2013/zfs-a-truly-superior-filesystem/">ZFS: A truly Superior Filesystem</a></h2>
        <span class="postDetails clearfix"><time class="date details">May 20 2013</time><span class="tagLinks details">Tags: 	
	  <span class="tags"><a class="tags" href="/posts/tags/zfs/">zfs</a></span>
	
	  <span class="tags"><a class="tags" href="/posts/tags/freebsd/">FreeBSD</a></span>
	</span></span>
        <p>My wife just recently got a new HP Chromebook, causing her to rapidly abandon her 3-year old Toshiba NB 205 netbook. This gave me a new computer to experiment on, and of course I installed FreeBSD.</p>

<p>This is a very low-powered machine, with a ton of case-edge built-in peripherals. It has 2G ram, and an internal disk upgraded to 230G. It originally came pre-packaged with Win7 “Starter” edition and a bunch of Toshiba bloatware, which makes it the perfect target for an OS nuke and wicked post-nuclear experimentation.</p>

<p>As my new testbed, this machine is running some of the newest, up-and-coming features of FreeBSD, among which is ZFS. I used these instructions for <a href="http://forums.freebsd.org/showthread.php?t=31662" title="click me!">Road Warrior laptop</a>.</p>

<p>If you have ZFS, Perl and beadm installed, I wrote this little shell script to dump information from a variety of sources on FreeBSD</p>

<pre class="highlight shell"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div><div class="lineno">5</div><div class="lineno">6</div><div class="lineno">7</div><div class="lineno">8</div><div class="lineno">9</div><div class="lineno">10</div><div class="lineno">11</div><div class="lineno">12</div><div class="lineno">13</div><div class="lineno">14</div><div class="lineno">15</div><div class="lineno">16</div><div class="lineno">17</div><div class="lineno">18</div><div class="lineno">19</div><div class="lineno">20</div><div class="lineno">21</div><div class="lineno">22</div><div class="lineno">23</div><div class="lineno">24</div><div class="lineno">25</div><div class="lineno">26</div><div class="lineno">27</div><div class="lineno">28</div><div class="lineno">29</div><div class="lineno">30</div><div class="lineno">31</div></td><td class="code"><span class="c">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; gpart show&quot;</span>
gpart show
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; df&quot;</span>
df -H
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; zpool list&quot;</span>
zpool list
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; zfs list&quot;</span>
zfs list
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; beadm mount&quot;</span>
beadm list -s
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; ls -alF /.zfs/snapshots&quot;</span>
ls -alF /.zfs/snapshot
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s1">&#39;Command: &gt;&gt; gpart list | perl -ne /(Name:|label:|type:)/ &amp;&amp; print $_;&#39;</span>
gpart list | perl -ne <span class="s1">&#39;/(Name:|label:| type:)/ &amp;&amp; print $_;&#39;</span>
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; zpool status&quot;</span>
zpool status
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; zpool get all&quot;</span>
zpool get all
<span class="nb">echo</span> <span class="s2">&quot;========================================================&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Command: &gt;&gt; zpool history&quot;</span>
zpool <span class="nb">history</span>
</td></tr></tbody></table></pre>
<p>What is ZFS exactly? The skinny is that it’s Sun’s newest(ish) file system that seriously improves on anything else in existence right now. By far and away, it is the most seriously sophisticated file system out there today. It’s on OpenSolaris now, and FreeBSD developers have been quietly tooling away at it for a few years now. I expect/can only hope it will ultimately replace UFS.</p>

<p><a href="http://hub.opensolaris.org/bin/view/Community+Group+zfs/whatis">ZFS:about</a></p>

<p>Some things ZFS has that other FS do not:</p>

<p><strong>End-to-end Data integrity:</strong> According to Wikipedia’s ZFS article (https://en.wikipedia.org/wiki/ZFS) about 1 in 90 hard drives have undetected failures that neither hardware nor software can normally catch. This phenomenon is called “silent corruption”, and is experienced at large data providers and small ones with cheap hardware. ZFS can be employed in these cases, to detect and repair silently corrupted data because it uses all kinds of mechanisms to validate and store data that raid doesn’t. </p>

<p><strong>Snapshots and Boot Environments:</strong> Similar in concept to Win7 restore-points, this feature gives you the ability to create perfect bootable copy (a snapshot) of an existing OS. On the Toshiba, it takes only 3-5 seconds, and uses a nominal amount of disk space (try that on Win7). You can clone these, boot into them, destroy them, mount them or even export them to another system. The boot configurations concept is from Solaris. If you install a copy of a utility called beadm from the ports tree, it emulates Solaris’ nice interface in FreeBSD, and offers even more elegance than using the two management utilities: zpool and zfs</p>

<p><strong>No fsck:</strong> ZFS uses a maintenance technique called “scrubbing” which is run periodically, as frequently as you would run an SSD optimizer or defragmenter. Scrubbing, unlike fsck, can be run on an online, mounted, active disk, and checks not only metadata, but the data itself for corruption. Auto-repair is done via RAID-Z (ZFS software raid, another feature) or by a kind of on-disk bit replication mechanism which looks into redundant copies for good replacement data. In ZFS, copy-on-write semantics are used, so data on the disk isn’t corrupted the same way it can be on a normal file system.</p>

<p><strong>No partitions or volumes:</strong> Hardware is organized using into datasets and zpools, or virtualized storage. No formatting, slices or fdisk. You can easily create filesystems within these pools, and other filesystems. You can add disks in as mirrors from the command line, impose quotas on filesystems, reserve storage, share storage, compress, have transactions, and no real limits on numbers of directories, number of filesystems, paths, and other things normally imposed on file systems.</p>

<p>And there are more features. It’s almost mind-boggling. ZFS seems to do E0VERYTHING right, and it’s just too good to pass-up.</p>

<p><a href="http://hub.opensolaris.org/bin/download/Community+Group+zfs/docs/zfslast.pdf">ZFS info</a></p>

<p><a href="https://wiki.freebsd.org/ZFS">FreeBSD ZFS info</a></p>

      </article>
      <footer class="footer clearfix">
	<div class="contact">
		<p class="details">Contact me, if that's what you want.</p>
	</div>
	<div class="links">
		<ul class="clearfix">
			<li class="details"><a href="/posts/2013.html">Archive</a></li>
			<li class="details"><a href="/rss.rss">RSS</a></li>
			<li class="details"><a href="mailto:allanbowhill@yahoo.com">Contact</a></li>
		</ul>
	</div>
</footer>

    </div>
  </body>
</html>
